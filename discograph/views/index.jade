<head>
  <meta charset="utf-8">
  <title>DiscoGraph</title>
  <link rel="stylesheet" href="/stylesheets/style.css">
  <!-- <script type="text/javascript" src="https://code.jquery.com/jquery-2.2.0.min.js"></script> -->
  <!-- <script type="text/javascript" src="../../frontend/bundle.js"></script> -->
  <script src="https://d3js.org/d3.v4.min.js"></script>

  <script type="text/javascript">
    $(document).ready(() => {
      const rockButton = document.getElementById("rock-toggle");
      const popButton = document.getElementById("pop-toggle");
      const hipHopButton = document.getElementById("hip-hop-toggle");
      const funkSoulButton = document.getElementById("funk-soul-toggle");
      const electronicButton = document.getElementById("electronic-toggle");
      const classicalButton = document.getElementById("classical-toggle");
      const jazzButton = document.getElementById("jazz-toggle");

      rockButton.addEventListener("click", () => genreButtonClick("rock", rockButton.clicked, $('#startYear').val(), $('#endYear').val()), false);
      popButton.addEventListener("click", () => genreButtonClick("pop", popButton.clicked, $('#startYear').val(), $('#endYear').val()), false);
      hipHopButton.addEventListener("click", () => genreButtonClick("hip-hop", hipHopButton.clicked, $('#startYear').val(), $('#endYear').val()), false);
      funkSoulButton.addEventListener("click", () => genreButtonClick("funk-soul", funkSoulButton.clicked, $('#startYear').val(), $('#endYear').val()), false);
      electronicButton.addEventListener("click", () => genreButtonClick("electronic", electronicButton.clicked, $('#startYear').val(), $('#endYear').val()), false);
      classicalButton.addEventListener("click", () => genreButtonClick("classical", classicalButton.clicked, $('#startYear').val(), $('#endYear').val()), false);
      jazzButton.addEventListener("click", () => genreButtonClick("jazz", jazzButton.clicked, $('#startYear').val(), $('#endYear').val()), false);

      localStorage.removeItem("subgenre");
      prefetchPop();
      prefetchFunk();
      $("#mainForm").submit( (e) => {
        e.preventDefault();
        const data = {'sub_genre': $('#genre').val(), 'startYear': $('#startYear').val(), 'endYear': $('#endYear').val() };
        subGenreQuery(data).then((response) => {
          const genre = Object.keys(response)[0];
          const releases = response[Object.keys(response)[0]];
          const tempObject = {};
          tempObject[genre] = releases;
          localStorage.setItem("subgenre", JSON.stringify(tempObject));
          debugger
          writeGraph(localStorage, data["startYear"], data["endYear"]);
        },
      (err) => console.log(err));;
      });
    });
  </script>
</head>


<body>
  <header><h1 class="logo">DiscoGraphs</h1></header>
  <main>
    <form id="mainForm">
      <div class="yearInputs group">


        <label for="startYear">Start Year
          <input type="range" min="1960" max="2015" value="1970"
          name="startYear" step="1" id="startYear" oninput="startYearUpdate(value)">
          <output for="startYear" id="startYearDisplay">1970</output>
        </label>


      <label for="endYear" id="endYearLabel">End Year
        <input type="range" min="1961" max="2016" value="1985"
        name="endYear" id="endYear" oninput="endYearUpdate(value)">
        <output for="endYear" id="endYearDisplay">1985</output>
      </label>
    </div>

      <div id="d3Graph"></div>

      <section class="genre-buttons group">
        <div class="switch">
          <input type="checkbox" class="check-to-toggle" id="rock-toggle">
          <label for="rock-toggle"></label>
        </div>

        <div class="switch">
          <input type="checkbox" class="check-to-toggle" id="pop-toggle" checked>
          <label for="pop-toggle"></label>
        </div>

        <div class="switch">
          <input type="checkbox" class="check-to-toggle" id="hip-hop-toggle">
          <label for="hip-hop-toggle"></label>
        </div>

        <div class="switch">
          <input type="checkbox" class="check-to-toggle" id="funk-soul-toggle" checked>
          <label for="funk-soul-toggle"></label>
        </div>

        <div class="switch">
          <input type="checkbox" class="check-to-toggle" id="electronic-toggle">
          <label for="electronic-toggle"></label>
        </div>

        <div class="switch">
          <input type="checkbox" class="check-to-toggle" id="classical-toggle">
          <label for="classical-toggle"></label>
        </div>

        <div class="switch">
          <input type="checkbox" class="check-to-toggle" id="jazz-toggle">
          <label for="jazz-toggle"></label>
        </div>
      </section>

      <label for="genre" id="genreLabel">Sub-Genre
        <input type="text" name="genre" value="" id="genre">
        <button>Add sub-genre</button>
      </label>
    </form>
  </main>
</body>
